<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PWA Install Prompt Demo</title>

  <!-- Manifest -->
  <link rel="manifest" href="./manifest.json" />

  <!-- Theme color (opsional, tapi bagus) -->
  <meta name="theme-color" content="#111111" />

  <style>
    body { font-family: system-ui, Arial, sans-serif; padding: 24px; }
    #btnInstall { padding: 12px 18px; font-size: 16px; cursor: pointer; display: none; }
    .note { margin-top: 12px; opacity: 0.8; }
  </style>
</head>
<body>
  <h1>Install App Prompt</h1>

  <button id="btnInstall">Install App</button>
  <div class="note" id="status">Menunggu eligibility PWA...</div>

  <script>
    // 1) Register Service Worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js")
        .then(() => console.log("‚úÖ Service Worker registered"))
        .catch(err => console.warn("‚ùå SW register failed:", err));
    }

    const btnInstall = document.getElementById("btnInstall");
    const statusEl = document.getElementById("status");
    let deferredPrompt = null;

    // 2) Tangkap event "beforeinstallprompt"
    window.addEventListener("beforeinstallprompt", (e) => {
      // Stop auto prompt bawaan
      e.preventDefault();

      deferredPrompt = e;
      btnInstall.style.display = "inline-block";
      statusEl.textContent = "‚úÖ Install tersedia. Klik tombol Install App.";
      console.log("‚úÖ beforeinstallprompt captured");
    });

    // 3) Munculkan prompt ketika user klik tombol
    btnInstall.addEventListener("click", async () => {
      if (!deferredPrompt) {
        statusEl.textContent = "‚ùå Prompt belum siap. Pastikan manifest & SW aktif.";
        return;
      }

      deferredPrompt.prompt(); // <- ini yang memicu popup "Install app"

      const choice = await deferredPrompt.userChoice;
      console.log("User choice:", choice);

      if (choice.outcome === "accepted") {
        statusEl.textContent = "üéâ User memilih Install!";
      } else {
        statusEl.textContent = "üôÖ User membatalkan Install.";
      }

      deferredPrompt = null;
      btnInstall.style.display = "none";
    });

    // 4) Event setelah benar-benar terinstall
    window.addEventListener("appinstalled", () => {
      console.log("üéâ App installed");
      statusEl.textContent = "‚úÖ App sudah terpasang.";
    });
  </script>
</body>
</html>
